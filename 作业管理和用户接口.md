## 用户接口

### 1. 用户接口类型

- 作业控制级接口——面向人
  
    >命令驱动，图形化驱动

- 程序级接口——面向应用程序
### 2. 系统功能调用（System Call）

系统调用过程：

![Alt][系统调用过程]

访管指令：也叫陷阱指令、自陷指令，是在算态下执行的一条特殊的指令，可引发中断，使得程序由算态切换到管态（自愿进管）。

Linux 的系统调用主要有以下这些：

|   Task   | Commands                    |
| :------: | --------------------------- |
| 进程控制 | fork(); exit(); wait();     |
| 进程通信 | pipe(); shmget(); mmap();   |
| 文件操作 | open(); read(); write();    |
| 设备操作 | ioctl(); read(); write();   |
| 信息维护 | getpid(); alarm(); sleep(); |
|   安全   | chmod(); umask(); chown();  |

系统调用功能和普通调用功能的区别：

- 运行状态不同：系统调用的调用过程和被调用过程运行在不同状态，开销较大
- 调用方法不同：系统调用必须通过软中断机制进入系统核心，然后才能执行相应的处理程序；普通过程调用则可以直接调用
- 返回问题：普通的过程调用完成后直接返回调用过程继续执行。系统功能调用在返回时需要重新进行调度

## 作业管理（批处理系统）

### 什么是作业

作业（Job），可以将作业看作是用户要求计算机处理的一次任务。

作业的具体体现形式为程序，一个作业可能对应一个或多个程序。

### 作业的分类

- 脱机作业：用户不直接和计算机系统交互
- 联机作业：用户在作业执行过程中可以直接和计算机系统交互，控制执行过程

### 作业的执行过程

作业现在系统中一般要经历输入->后备->执行->完成四个状态的转化。

（1）用户将自己的程序和数据提交给系统的后援存储器(外存)后，作业即进入输入状态；

（2）然后由作业注册程序为进入系统的作业建立作业控制块(JCB)，并把它加入到后备作业队列中，等待作业调度程序调度，这时作业处于后备状态；

（3）一个处于后备状态的作业被作业调度程序选中并分配了必要的资源，建立了一组相应的进程后，该作业进入执行状态；

（4）当程序正常运行结束或因发生错误而终止时，作业进入完成状态，退出系统。

### 作业的输入输出方式

- 脱机输入/输出

    由外围机控制，用户把作业首先输入磁带上；操作员把装有输入数据的磁带拿到主机的高速外围设备上和主机连接

- 联机输入/输出

    用户和系统通过终端交互会话来输入作业。作业执行过程中操作系统与用户之间需要不断地交互信息

- **SPOOLing 系统**
    
    Simultaneous Peripheral Operation On-Line ，联机外围设备同时操作系统。兼具脱机和联机方式的优点，可以实现联机方式下的主机和外围设备的同时工作，又称为假脱机，也即以联机的方式得到脱机的效果.

    SPOOLing系统的核心思想是：在主机和外围设备之间设置一个磁盘缓冲区，使得主机和外围设备可以同时工作，而不必等待对方的完成。SPOOLing技术是在通道技术和多道程序设计技术的基础上发展起来的。SPOOLing系统由专门负责I/O的常驻内存的进程以及输入井、输出井组成。

    ![Alt][SPOOLing系统原理]

    输入井是模拟脱机输入时的磁盘，输出井是模拟脱机输出时的磁盘。输入井和输出井都是由磁盘模拟的，因此可以同时进行输入和输出，而不必等待对方的完成。输入缓存区和输出缓存区是在内存中开辟的两个缓存区。

    输入进程SP1和输出进程SP2属于系统进程，其优先级高于其它任何用户进程，接受系统调度程序的调度运行。SP1模拟脱机输入时的外围机，将数据从输入机通过输入缓存区写入输入井，CPU需要时直接从输入井读入内存。SP2模拟脱机输出时的外围控制机，把用户需要输出的数据先从内存送到输出井，待输出设备空闲时，再将输出井中的数据经过输出缓存区送到输出设备上。

    SPOOLing系统的优点：

    - 提高了 I/O 速度
    - 将独占设备改为共享设备
    - 实现了虚拟设备功能




[系统调用过程]: pictures\系统调用过程.png
[SPOOLing系统原理]: pictures\SPOOLing系统原理.png