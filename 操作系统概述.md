## 基本概念

### 1. 操作系统的地位

操作系统为建立用户与计算机之间的接口，为裸机配置的一种系统软件。

操作系统是裸机上的第一层软件，位于系统硬件之上，所有其它软件之下（是其它所有软件的共同环境）.

### 2. 操作系统的定义

操作系统是控制和管理计算机硬件和软件资源、合理地组织和管理计算机的工作流程以方便用户使用的程序的集合.

## 操作系统的特征

### 1. 并发 (concurrence)

并发是指宏观上在一段时间内能同时运行多个程序，而并行则指同一时刻能运行多个指令。

并行需要硬件支持，如多流水线、多核处理器或者分布式计算系统。

操作系统通过引入进程和线程，使得程序能够并发运行。

在微观上，可以是串行的。

### 2. 共享 (sharing)

共享是指系统中的资源可以被多个并发进程共同使用。

有两种共享方式：互斥共享和同时共享。

互斥共享的资源称为临界资源，例如打印机等，在同一时刻只允许一个进程访问，需要用同步机制来实现互斥访问。

同时共享的资源，在一段时间内允许多个进程同时访问

>并发和共享是操作系统下两个最基本的特征，这两者是相互依存的

### 3. 虚拟 (virtuals)

虚拟技术把一个物理实体转换为多个逻辑实体。

主要有两种虚拟技术：时（时间）分复用技术和空（空间）分复用技术。

多个进程能在同一个处理器上并发执行使用了时分复用技术，让每个进程轮流占用处理器，每次只执行一小个时间片并快速切换。

虚拟内存使用了空分复用技术，它将物理内存抽象为地址空间，每个进程都有各自的地址空间。地址空间的页被映射到物理内存，地址空间的页并不需要全部在物理内存中，当使用到一个没有在物理内存的页时，执行页面置换算法，将该页置换到内存中。

### 4. 不确定性 (uncertainty)

多道程序环境下程序的执行是以异步方式执行的。每个程序在何时执行、执行多长时间、以什么顺序执行都是不确定的。

然而，只要在相同的环境下给与相同的输入，其执行结果总是确定的。

## 操作系统的发展

### 1. 人工操作方式
  
手工把纸带装入纸带输入机，启动输入机输入计算机，启动计算机计算，取走结果。用户即使操作员，又是操作员。该操作方式下计算机工作特点 ：

（1） 用户独占全机，资源利用率低

（2） CPU等待人工操作，CPU利用率低

### 2. 批处理阶段

为了提高计算机的利用率，人们提出了批处理的概念。批处理是指把一批作业按照一定的顺序排好队，计算机按照一定的顺序自动运行，直到运行完所有的作业为止。

- 单道批处理系统（Simple Batch Processing）

    > 也有资料称之为脱机批处理，脱机输入/输出

    把系统的输入/输出工作交给一台外围计算机。用户把程序和数据输入到外围计算机，外围计算机把输入的数据和程序转存到磁带上，然后把磁带送到主机，主机把程序和数据装入内存，执行程序，把结果送到磁带上，再由外围计算机把磁带上的结果输出到打印机上。

    提高了CPU利用率和输入输出的速度。但是，用户仍然需要等待作业完成才能获得结果，CPU仍然需要等待人工操作。

- 多道批处理系统（Multi-Programming Batch Processing）

    多道程序设计技术的出现给计算机系统的管理带来了巨大挑战，如：内存共享与保护问题，处理器调度问题，I/O设备的共享及竞争问题等，为解决这些问题，形成了现代操作系统的雏形。所以说多道程序设计技术是操作系统形成的标志。

    多道程序在内存中同时驻留，它们共享CPU和其他资源。当一个作业需要等待某事件发生时，CPU可以立刻切换到另一个作业上去执行，从而提高了CPU的利用率。

    但是，多道程序环境下，程序的执行是异步的，程序的执行速度不可预知，因此，需要采用某种措施来保证程序的执行顺序。

    为了保证程序的执行顺序，需要引入作业调度和内存管理两个概念。

### 3. 分时操作系统 (Time-Sharing System)

分时操作系统是一种允许多个用户通过终端同时连接到一台计算机上的操作系统。分时系统的基本特征是：多路性、独立性、及时性、交互性。

分时系统的基本原理是：把CPU的时间分成很多个时间片，每个时间片分配给一个用户，用户在这个时间片内独占CPU。由于CPU的时间片很短，用户感觉好像计算机在同一时间为他服务一样，这就是分时系统的基本原理。

分时系统的出现，使得用户不再需要等待作业完成才能获得结果，而是可以实时地与计算机交互。
     
分时系统不能优先处理一些紧急任务，因此引入了实时操作系统。

### 4. 实时操作系统 (Real-Time System)

在限定时间内完成某些紧急任务，而不需要时间片排队。

实时操作系统分为硬实时操作系统和软实时操作系统。

- 硬实时操作系统：某个动作必须绝对地在规定的时间内完成，否则就会产生严重的后果。例如：导弹控制系统、核反应堆控制系统等。
- 软实时操作系统：某个动作必须在规定的时间内完成，但是如果不能完成，后果并不严重。例如：飞机订票系统，银行管理系统等。

### 5. 网络操作系统 (Network System)

网络操作系统是指由多台计算机组成的计算机网络，实现各种资源共享和各台计算机之间地通信。

### 6. 分布式操作系统 (Distributed System)

分布式操作计算机是指由多台计算机组成，这些计算机通过网络进行通信和协作，完成用户的任务。用于管理该系统的操作系统就是分布式操作系统。分布式操作系统与网络操作系统的本质不同是，分布式操作系统中若干计算机相互协同完成同一任务。

### 7. 个人计算机操作系统 (Personal Computer System)

针对单用户做出优化的操作系统，常见的有：Windows、Mac OS、Linux、Unix等。

除此之外，还有嵌入式操作系统、移动操作系统、实时嵌入式操作系统等。

## 操作系统的运行机制

### 1. 处理器运行机制

对处理器而言，有两种性质不用的程序：操作系统内核程序和用户自编程序（应用程序），前者可以运行特权指令，而后者不允许运行这些特权指令。

- 特权指令：只能由操作系统内核程序运行的指令，例如：关中断、修改时钟中断向量等。
- 非特权指令：用户自编程序可以运行的指令，例如：加法、减法、乘法、除法等。

在具体实现上，根据程序的不同，CPU所处状态分为核心态和用户态。

- 核心态：又称为管态、内核态。CPU执行操作系统内核程序时所处的状态，此时CPU可以运行特权指令。
- 用户态：又称为目态。CPU执行用户自编程序时所处的状态，此时CPU不可以运行特权指令。

在CPU中设置程序状态寄存器（PSW）来标志处理器当前处于的状态。

### 2. 中断和异常

- 中断 (Interrupt)：是指CPU在执行程序的过程中，由于发生了某些事情而中断正在执行的程序，转去执行相应的处理程序，处理完毕后再返回断点处继续执行原来的程序。
- 异常 (Exception)：是指CPU在执行程序的过程中，由于程序本身的原因而产生的中断，例如：除数为0、越界访问等。

### 3. 系统调用

系统调用是指用户自编程序通过操作系统提供的接口，向操作系统发出服务请求，从而获得操作系统的服务。是用户态到核心态的唯一入口。

## 体系结构模型

- 微内核（micro kernel）
    
    基本思想：内核尽可能小，只实现操作系统的基本功能；将更多的操作系统功能放在核心之外，作为独立的服务进程运行。

    其特点是：内核简单，安全可靠，可移植性好。

- 单内核（monolithic kernel）

    基本思想：将核心分为若干个模块，模块间的通信通过调用其它模块中的函数来实现。

    其特点为：执行效率高，但可移植性相对减弱。
