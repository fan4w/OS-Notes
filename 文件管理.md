## 文件基本概念

### 文件

文件是记录在外存上的，具有符号名的，在逻辑上具有完整意义的一组相关信息项的集合。从用户的角度看，文件是逻辑外存的最小分配单元，即信息(数据)只能以文件的形式写入外存

### 文件管理系统

文件管理系统是操作系统中实现文件统一管理的一组软件和相关数据的集合，它是专门负责管理和存取文件信息的软件机构，简称文件系统

常见文件管理系统有FAT16、FAT32、NTFS、EXT2、EXT3、EXT4等

### 文件组成部分

文件由文件体和文件说明（属性）组成。
- 文件体是文件的实际信息
- 文件说明是对文件的描述信息，包括文件名、文件类型、文件存放地址、文件长度、文件创建时间、文件最后修改时间、文件保护码等

### 文件类型

对不同文件进行区分管理，提高系统效率

分类标准：
- 文件后缀
- 文件性质和用途
- 信息保存期限
- 文件的保护方式

## 文件的结构

### 逻辑结构

用户观察到的文件内容组织形式，独立于物理储存设备

### 物理结构

文件的内部组织形式，即文件在物理存储设备上的存放方法

#### 操作系统管理磁盘数据的基本单位

- 数据块/磁盘块
- 通常为磁盘的整数倍
- 操作系统给出的访问地址：逻辑地址

#### 几种常见的物理存储方式

- 连续存储
- 链式结构
- 索引结构

### 文件的存取方式

- 顺序读取：对文件中的数据按照顺序依次读写
- 随机读取：
  - 直接存取：允许用户随意读取文件中的任何一个物理记录
  - 按键存取法：根据键值(key value)存取文件中数据

## 文件的目录

目录是FCB(File Control Block)的集合，FCB即文件的属性信息。通过目录将所有的FCB组织在一起，通过搜索所有文件的FCB查询文件，方便了文件的检索操作。一个文件目录也被看做是一个文件，称为目录文件

### 文件的目录结构

如果目录文件过大（占多个磁盘块），查询文件时将目录调入内存，导致内存消耗过大。查询时要多次访问磁盘，查询速度慢。引入索引节点（ i-node）存放文件说明信息，索引节点按索引节点号排序。每个目录项为文件名和索引节点构成

通常采用多级树形结构，实现“按名存取”，UNIX系统线性检索方式查找所需资源。

## 文件共享

不同的进程或用户使用同一个文件，实际上文件的实体只有一个。UNIX中，文件共享通过硬链接或软链接
>这块真不如直接问ChatGPT，课本和PPT都不讲人话

### 硬链接

当创建一个硬链接时，实际上是创建了一个指向同一物理文件的新文件路径。这个新路径与原始文件路径完全相同，它们都指向同一个文件的实际数据块。因此，无论使用哪个路径访问该文件，都会看到同样的文件内容

硬链接的局限：
- 不能用于链接目录
- 不能跨越文件系统的范围

### 软链接

软链接（Symbolic Link），也被称为符号链接或软连接，是操作系统中的一种特殊文件类型。软链接是一个指向文件或目录的文件，它包含了指向实际文件或目录的路径。

软链接可以理解为一个快捷方式或别名，它创建了一个新的文件路径，该路径指向另一个文件或目录的位置。与硬链接不同，软链接本身并不包含实际文件的数据，它只是一个指向文件的路径。

>省流：快捷方式

软链接的优点：
- 可以连接目录
- 可用于跨越文件系统甚至网络

## 文件的操作

### 打开文件机构

操作系统在内存内设置了一个精炼的文件机构，用于实现灵活方便高效的文件操作，这套机构称为 **打开文件机构**

打开文件机构的组成：
- 内存控制文件块(内存索引节点)
- 系统打开文件控制块
- 用户打开文件表

### 内存控制文件块

当打开某一个文件时，如果找不到其相应的内存inode，就在内存中将外存inode中的主要部分复制进去（适当变化），形成内存inode。

当需要查询、修改文件的控制信息时，直接在内存inode中进行

当关闭文件时，如果内存inode被修改过，则更新对应的外存inode信息

### 系统打开文件控制块

系统打开文件表用于记录所有打开文件的控制信息

### 用户打开文件表

文件通常是通过进程来操作的，因此每一个文件都有一个用户(进程)。同样每一个进程可打开多个文件。

在操作系统中，每一个进程都有一张打开文件表——用户打开文件表，用于记录该进程打开的所有文件的控制信息

## 外存空间管理

外存具有较大的存储空间，且被多用户共享，用户执行程序经常要在磁盘上存储、删除文件，因此，文件系统必须对磁盘空间进行有效管理

外存空闲空间管理的数据结构通常称为磁盘分配表(Disk Allocation Table)

常见的空闲空间管理办法：
- 空闲区表
- 位示图
- 空闲块链

### 空闲区表

将外存空间上一个连续未分配区域称为“空闲区”。操作系统为磁盘外存上所有空闲区建立一张空闲表，每个表项对应一个空闲区，空闲表中包含序号、空闲区的第一块号、空闲块的块数等信息

### 位示图

位示图是一种位图，每一位对应一个磁盘块，位示图中的每一位用来表示对应磁盘块的使用情况，0表示空闲，1表示已分配

### 空闲块链

每个空闲物理块中有指向下一个空闲物理块的指针，所有空闲物理块构成一个链表，链表的头指针放在文件存储器的特定位置上（如管理块中）

### 成组链接法

将空闲块分成若干组，每100个空闲块为一组。每组的第一个空闲块登记了下一组空闲块的物理盘块号和本组空闲块总数

## 磁盘调度算法

### 先来先服务算法

### 最短寻道时间优先算法

### 电梯调度算法

## 文件存储空间的分配